name: Deploy

on:
  workflow_run:
    workflows:
      - 'Lint'
      - 'Test'
      - 'Build (sdk)'
      - 'Build and push docker image'
    types:
      - completed

jobs:
  deploy-to-test-env:
    runs-on: ubuntu-latest
    environment:
      name: test
    name: deploy-to-test
    steps:
      - uses: ahmadnassri/action-workflow-run-wait@v1.4.4
        with:
          timeout: 1440000
      - run: |
          curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer ${secrets.DIGITAL_OCEAN_TOKEN}" "https://api.digitalocean.com/v2/apps/${secrets.DIGITAL_OCEAN_APP_ID}/deployments" -d '{ "force_build": true }' | jq -e .deployment.id
